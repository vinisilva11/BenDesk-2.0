{% extends "base.html" %}
{% block content %}

<div class="container-fluid py-4">

  <!-- Cabe√ßalho -->
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
    <h3 class="fw-bold text-white mb-0">üì¶ Controle de Estoque</h3>
    <div class="d-flex flex-wrap gap-2">

      <!-- ‚úÖ Entrada (√∫nico bot√£o para cadastrar item) -->
      <button type="button"
              class="btn btn-success d-flex align-items-center gap-2"
              data-bs-toggle="modal"
              data-bs-target="#entradaModal">
        <i data-lucide="arrow-down-circle"></i> Entrada
      </button>


      <!-- ‚úÖ Sa√≠da -->
      <button type="button"
              class="btn btn-warning d-flex align-items-center gap-2 text-dark"
              data-bs-toggle="modal"
              data-bs-target="#saidaItemModal">
        <i data-lucide="arrow-up-circle"></i> Sa√≠da
      </button>

      <!-- ‚úÖ Hist√≥rico -->
      <a href="#historicoSection" class="btn btn-outline-light d-flex align-items-center gap-2">
        <i data-lucide="clock-history"></i> Hist√≥rico
      </a>

      <!-- ‚úÖ Ver Itens -->
      <a href="{{ url_for('estoque.lista_estoque') }}" class="btn btn-outline-info d-flex align-items-center gap-2">
        <i data-lucide="list"></i> Ver Itens
      </a>
    </div>
  </div>

  <!-- Indicadores -->
  <div class="row g-4 mb-4 text-center justify-content-center">
    <div class="col-md-4 col-lg-3">
      <div class="card p-4 h-100 border-0 shadow-sm bg-dark text-white rounded-4">
        <h6 class="fw-bold mb-2"><i data-lucide="download"></i> Entradas</h6>
        <h2 class="fw-bold text-success">{{ entradas or 0 }}</h2>
        <small class="text-secondary">Movimenta√ß√µes de entrada</small>
      </div>
    </div>

    <div class="col-md-4 col-lg-3">
      <div class="card p-4 h-100 border-0 shadow-sm bg-dark text-white rounded-4">
        <h6 class="fw-bold mb-2"><i data-lucide="upload"></i> Sa√≠das</h6>
        <h2 class="fw-bold text-danger">{{ saidas or 0 }}</h2>
        <small class="text-secondary">Movimenta√ß√µes de sa√≠da</small>
      </div>
    </div>
  </div>

  <!-- Hist√≥rico de Movimenta√ß√µes -->
  <div id="historicoSection" class="card bg-dark border-0 shadow-lg p-4 mt-4">
    <h5 class="fw-bold text-white mb-3">
      <i data-lucide="clock-history"></i> Hist√≥rico de Movimenta√ß√µes
    </h5>

    <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
      <table class="table table-dark table-hover align-middle rounded-3 overflow-hidden">
        <thead class="bg-black bg-opacity-50 sticky-top">
          <tr class="text-secondary small text-uppercase">
            <th>ID</th>
            <th>Tipo</th>
            <th>Item</th>
            <th>Quantidade</th>
            <th>Descri√ß√£o</th>
            <th>Usu√°rio</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          {% for mov in historico %}
          <tr>
            <td>{{ mov.id }}</td>
            <td>
              {% if mov.tipo == 'entrada' %}
                <span class="badge bg-success">Entrada</span>
              {% else %}
                <span class="badge bg-danger">Sa√≠da</span>
              {% endif %}
            </td>
            <td>{{ mov.item.nome if mov.item else '‚Äî' }}</td>
            <td>{{ mov.quantidade }}</td>
            <td>{{ mov.descricao or '‚Äî' }}</td>
            <td>{{ mov.usuario or '‚Äî' }}</td>
            <td>{{ mov.timestamp.strftime('%d/%m/%Y %H:%M') }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>


<!-- ‚úÖ Modal Cadastrar Item -->
<div class="modal fade" id="entradaModal" tabindex="-1" aria-labelledby="entradaModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark text-white border-0 shadow-lg">
      <div class="modal-header border-secondary">
        <h5 class="modal-title" id="entradaModalLabel">‚ûï Cadastrar Novo Item</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form method="POST" action="{{ url_for('estoque.novo_material') }}">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label small text-secondary">Nome do Material</label>
              <input type="text" name="nome" class="form-control bg-black text-white border-secondary" required>
            </div>
            <div class="col-md-6">
              <label class="form-label small text-secondary">Categoria</label>
              <select name="categoria" class="form-select bg-dark text-light border-secondary" required>
                <option value="">Selecione</option>
                <option value="Perif√©ricos">Perif√©ricos</option>
                <option value="Acess√≥rios de Computador">Acess√≥rios de Computador</option>
                <option value="Armazenamento">Armazenamento</option>
                <option value="Redes e Conectividade">Redes e Conectividade</option>
                <option value="Energia">Energia</option>
                <option value="Impress√£o">Impress√£o</option>
                <option value="Computadores e Notebooks">Computadores e Notebooks</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label small text-secondary">Unidade</label>
              <select name="unidade" class="form-select bg-dark text-light border-secondary">
                <option value="Unidade">Unidade</option>
                <option value="Caixa">Caixa</option>
                <option value="Kit">Kit</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label small text-secondary">Quantidade</label>
              <input type="number" step="0.01" name="quantidade" class="form-control bg-black text-white border-secondary" required>
            </div>
            <div class="col-md-12">
              <label class="form-label small text-secondary">Observa√ß√µes</label>
              <textarea name="observacoes" class="form-control bg-black text-white border-secondary" rows="2"></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer border-secondary">
          <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar Item</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ‚úÖ Modal Entrada -->
<div class="modal fade" id="entradaItemModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark text-white border-0 shadow-lg">
      <div class="modal-header border-secondary">
        <h5 class="modal-title">Registrar Entrada</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form method="POST" action="{{ url_for('estoque.novo_material') }}">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label small text-secondary">Nome do Material</label>
              <input type="text" name="nome" class="form-control bg-black text-white border-secondary" required>
            </div>
            <div class="col-md-6">
              <label class="form-label small text-secondary">Categoria</label>
              <input type="text" name="categoria" class="form-control bg-black text-white border-secondary">
            </div>
            <div class="col-md-4">
              <label class="form-label small text-secondary">Quantidade</label>
              <input type="number" step="0.01" name="quantidade" class="form-control bg-black text-white border-secondary" required>
            </div>
            <div class="col-md-12">
              <label class="form-label small text-secondary">Observa√ß√µes</label>
              <textarea name="observacoes" class="form-control bg-black text-white border-secondary" rows="2"></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer border-secondary">
          <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-success">Registrar Entrada</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ‚úÖ Modal Sa√≠da -->
<div class="modal fade" id="saidaItemModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark text-white border-0 shadow-lg">
      <div class="modal-header border-secondary">
        <h5 class="modal-title">Registrar Sa√≠da</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form method="POST" action="{{ url_for('estoque.saida_estoque') }}">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label small text-secondary">Item</label>
              <select name="item_id" class="form-select bg-dark text-light border-secondary" required>
                <option value="">Selecione</option>
                {% for item in itens %}
                <option value="{{ item.id }}">{{ item.nome }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label small text-secondary">Quantidade</label>
              <input type="number" step="0.01" name="quantidade" class="form-control bg-black text-white border-secondary" required>
            </div>
            <div class="col-md-6">
              <label class="form-label small text-secondary">Respons√°vel</label>
              <input type="text" name="responsavel" class="form-control bg-black text-white border-secondary" required>
            </div>
            <div class="col-md-12">
              <label class="form-label small text-secondary">Observa√ß√µes</label>
              <textarea name="observacoes" class="form-control bg-black text-white border-secondary" rows="2"></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer border-secondary">
          <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-warning text-dark">Registrar Sa√≠da</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  lucide.createIcons();
</script>

{% endblock %}
